

---

# 이미지 서버 데이터 흐름 (Data Flow)

## 1단계: 업로드 (Upload) - Spring Boot 담당

* **목적**: 파일을 안전하게 서버의 디스크에 기록하는 것.
* **핵심 역할**: 비즈니스 로직 처리 및 파일 시스템 쓰기 (Write)

### 상세 흐름

1. **요청 (Request)**
* 개발자가 `MultipartFile`과 프로젝트명(`project`)을 **Spring Boot (Port 8080)**로 보냅니다.


2. **비즈니스 로직 (Logic)**
* **파일명 난수화**: 파일명 중복 방지를 위해 UUID를 생성합니다. (예: `profile.jpg`  `550e84...jpg`)
* **디렉토리 확인**: `/var/www/images/프로젝트명/` 폴더가 없으면 자동으로 생성합니다.


3. **저장 (Save)**
* `transferTo()` 메서드를 통해 **Ubuntu 파일 시스템**에 물리적으로 파일을 씁니다.


4. **응답 (Response)**
* 저장이 완료되면, 이미지에 접근할 수 있는 **주소(URL)**만 생성하여 개발자에게 반환합니다.



---

## 2단계: 조회 (View) - Nginx 담당

* **목적**: 저장된 파일을 최대한 빠르게 클라이언트에게 보여주는 것.
* **핵심 역할**: 정적 파일 서빙 (Read) 및 리버스 프록시

### 상세 흐름

1. **요청 (Request)**
* 개발자 B(또는 웹 브라우저)가 URL(`http://IP/images/...`)을 호출합니다.


2. **수신 (Receive)**
* 이 요청은 **80번 포트의 Nginx**가 가장 먼저 받습니다.


3. **경로 매핑 (Mapping)**
* Nginx는 설정 파일(`nginx.conf`)을 확인하여 요청이 `/images`로 시작하는지 판단합니다.


4. **파일 전송 (Serving)**
* **중요**: Spring Boot에게 요청을 넘기지 않습니다.
* Nginx가 직접 **Ubuntu 디스크**에서 파일을 꺼내 브라우저로 전송합니다.



---